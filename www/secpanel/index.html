<!DOCTYPE HTML>
<html lang="en-US">
<head>
	
	<meta charset="UTF-8">
	<title>Domoticz Security Panel</title>
		
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="viewport" content="width=540, initial-scale=1.0">

	<link href="css/shared.css" rel="stylesheet" />

	<!-- ToDo: Make theme folder selectable from withoin domoticz -->
	<link href="themes/default/css/style.css" rel="stylesheet" />
	
	<script src="../js/jquery-1.12.0.min.js"></script>
	<script src="../js/i18next-1.8.0.min.js"></script> 
	<script src="../js/domoticz.js"></script>
	<script src="../js/md5.js"></script>
	
	<script src="js/ion.sound.min.js"></script>
	
	<script src="js/securitypanel.js"></script>
	<script type="text/javascript">

		/* global ion, $, MakeDatatableTranslations, SecurityPanel */
		
		// Set up sound
		ion.sound({
			sounds: [
				{name: "arm"},
				{name: "disarm"},
				{name: "key"},
				{name: "wrongcode"}
			],
			// main config
			path: "media/",
			preload: true,
			multiplay: true,
			volume: 0.9
		});
		
		// Set up securitypanel
		var securityPanel = SecurityPanel();
		
		// Setup translation
		function SetLanguageEx(lng) {
			
			$.i18n.init({
				resGetPath: '/i18n/domoticz-__lng__.json',
				fallbackLng: false,
				getAsync: false,
				debug: true,
				useCookie: false,
				nsseparator: 'aadd',
				keyseparator: 'bbcc',
				lng: lng
			});
			
			$('.translate').each(function(i, elm) {
				var e = $(elm);
				e.text($.i18n.t(e.text()));
			});
			
		}

		// DOM is ready, go go go!
		$(document).ready(function() {

			// Determine languange
			var lang = 'en';
			if(window.location.hash) {
				var hash = window.location.hash.substring(1);

				if(hash) {
					lang = hash;
				} 
			}
			
			SetLanguageEx(lang);
			
		 	// Entrypoint for "main loop"
		 	securityPanel.Start();
			 	
			// Setup events
			$('li.digit').on('touchstart click', function (e) {
				e.preventDefault();
				
				// Digit
				var 
					target = $(e.target),
					digit = target.data('digit');
				securityPanel.AddDigit(digit);
				
			});
			
			$('li.arm').on('touchstart click', function (e) {
				e.preventDefault();
				
				// Digit
				var 
					target = $(e.target),
					secstatus = target.data('secstatus'),
					secstatusParsed = parseInt(secstatus, 10);
				if(!isNaN(secstatusParsed)) {
					securityPanel.SetSecStatus(secstatusParsed);
				}
				
			});

			$('li.cancel').on('touchstart click', function (e) {
				e.preventDefault();
				
				// Update immediately
				securityPanel.Beep('out');
				securityPanel.ResetHeartbeat(0);
			});
			
		});

	</script>
</head>
<body>
	<div id="main">
		<div class="main-border">
			<div id="keypad">
				<div class="keypad-header">
					<div class="title fullscreen"><p>Domoticz Security Panel</p></div>
				</div>
				<form name="keypadinput">
					<input type="text" id="digitdisplay" value="" name="digitdisplay" disabled="disabled"/>
					<ul class="keypad-keys">
						<li class="digit" data-digit="1">1</li>
						<li class="digit" data-digit="2">2</li>
						<li class="digit" data-digit="3">3</li>
						<li class="arm disarm translate" data-secstatus="0">Disarm</li>
					</ul>
					<ul class="keypad-keys">
						<li class="digit" data-digit="4">4</li>
						<li class="digit" data-digit="5">5</li>
						<li class="digit" data-digit="6">6</li>
						<li class="arm translate" data-secstatus="1">Home</li>
					</ul>
					<ul class="keypad-keys">
						<li class="digit" data-digit="7">7</li>
						<li class="digit" data-digit="8">8</li>
						<li class="digit" data-digit="9">9</li>
						<li class="arm translate" data-secstatus="2">Away</li>
					</ul>
					<ul class="keypad-keys">
						<li class="digit" data-digit="*">*</li>
						<li class="digit" data-digit="0">0</li>
						<li class="digit" data-digit="#">#</li>
						<li class="arm cancel translate">Cancel</li>
					</ul>
				</form>
			</div>
		</div>
	</div>
</body>
</html>
